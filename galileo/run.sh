#!/bin/bash

export API_ENDPOINT=${API_ENDPOINT-http://18.219.170.177/vchains/2000/api/v1/}
export BASE_URL=${BASE_URL-http://18.219.170.177/vchains/2000}
export COMMIT=${COMMIT-master}
DATE=$(date +%Y-%m-%d-%H%M%S)
export RESULTS=${RESULTS-results}/$COMMIT/$DATE}

export STRESS_TEST_NUMBER_OF_TRANSACTIONS=120
export VCHAIN=2000
export LOG_FILE="stability-${DATE}.log"

echo "STRESS_TEST_NUMBER_OF_TRANSACTIONS=${STRESS_TEST_NUMBER_OF_TRANSACTIONS}"
echo "STRESS_TEST_FAILURE_RATE=${STRESS_TEST_FAILURE_RATE}"
echo "STRESS_TEST_TARGET_TPS=${STRESS_TEST_TARGET_TPS}"
echo "STRESS_TEST_TRANSACTIONS_PER_MINUTE=${STRESS_TEST_TRANSACTIONS_PER_MINUTE}"
echo "STRESS_TEST_METRICS_EVERY_NTH_TRANSACTION=${STRESS_TEST_METRICS_EVERY_NTH_TRANSACTION}"

mkdir -p $RESULTS

echo
echo "===== STARTING TO RUN ${STRESS_TEST_NUMBER_OF_TRANSACTIONS} TRANSACTIONS ====="
echo
echo "To follow progress, run: tail -f ${LOG_FILE}"
echo

go test ./../benchmark/... -count 1 -v > ${LOG_FILE} &